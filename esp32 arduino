#include <WiFi.h>
#include <WebSocketsServer.h>

#define LEFT_MOTOR_PIN 27
#define RIGHT_MOTOR_PIN 14

// Replace with your network credentials
const char* ssid = "your_SSID";
const char* password = "your_PASSWORD";

WebSocketsServer webSocket(80);

void setup() {
  Serial.begin(115200);

  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(1000);
    Serial.println("Connecting to WiFi...");
  }
  Serial.println(WiFi.localIP());

  webSocket.begin();
  webSocket.onEvent(onWebSocketEvent);

  ledcSetup(0, 5000, 16);
  ledcAttachPin(LEFT_MOTOR_PIN, 0);
  ledcSetup(1, 5000, 16);
  ledcAttachPin(RIGHT_MOTOR_PIN, 1);
}

void loop() {
  webSocket.loop();
}

void onWebSocketEvent(uint8_t client_num,
                      WStype_t type,
                      uint8_t * payload,
                      size_t length) {

  switch(type) {
    case WStype_DISCONNECTED:
      Serial.printf("[%u] Disconnected!\n", client_num);
      break;
    case WStype_CONNECTED:
      Serial.printf("[%u] Connected from %s url: %s\n", client_num, webSocket.remoteIP(client_num).toString().c_str(), payload);
      break;
    case WStype_TEXT:
      Serial.printf("[%u] get Text: %s\n", client_num, payload);
      
      // Here you should add code to handle the incoming commands.
      // For example, you can use the ArduinoJson library to parse the JSON:
      // https://arduinojson.org/
      // And then use the ledcWrite function to control the speed of the motors:
      // ledcWrite(channel, dutyCycle);

      break;
  }
}
